---
- hosts: vcenter
  become: yes
  gather_facts: yes
  vars_files:
    - vcenter_vars.yaml
  tasks:
    - name: Login task
      include_tasks: vcenter_login.yaml

    - name: Get hosts from vCenter
      uri:
        url: "https://{{ vcenter_server }}/rest/vcenter/datacenter"
        force_basic_auth: yes
        validate_certs: no
        headers:
          Cookie: "{{ login.set_cookie }}"
      register: vchosts

    - name: Print names of datacenters in the given vCenter
      debug:
        msg: "{{ item.name }}"
      with_items: "{{ vchosts.json.value }}"
...
